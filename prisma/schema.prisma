// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  name String
  email String @unique
  password String

  isActive Boolean @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // relacionamentos
  eventsCreated Event[] @relation("UserEvent")
  ridesAsDriver Ride[] @relation("UserRide")
  requests Request[] @relation("UserRequest")
}

model Address {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  state String
  city String
  district String
  street String
  number String

  events Event[] @relation("AddressEvent")
  ridesAsOrigin Ride[] @relation("RideOrigin")
  ridesAsDestination Ride[] @relation("RideDestination")
}

model Event {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  title String
  description String
  date DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  addressId String @db.ObjectId
  address Address @relation("AddressEvent", fields: [addressId], references: [id])

  createdById String @db.ObjectId
  createdBy User @relation("UserEvent", fields: [createdById], references: [id])

  rides Ride[] @relation("EventRide")
}

model Ride {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  totalSeats Int
  availableSeats Int
  date DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  eventId String @db.ObjectId
  event Event @relation("EventRide", fields: [eventId], references: [id])

  driverId String @db.ObjectId
  driver User @relation("UserRide", fields: [driverId], references: [id])

  originAddressId String @db.ObjectId
  origin Address @relation("RideOrigin", fields: [originAddressId], references: [id])

  destinationAddressId String @db.ObjectId
  destination Address @relation("RideDestination", fields: [destinationAddressId], references: [id])

  // relacionamentos
  requests Request[] @relation("RideRequest")
}

model Request {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  status RequestStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  rideId String @db.ObjectId
  ride Ride @relation("RideRequest", fields: [rideId], references: [id])

  requesterId String @db.ObjectId
  requester User @relation("UserRequest", fields: [requesterId], references: [id])

  @@unique([rideId, requesterId])
}